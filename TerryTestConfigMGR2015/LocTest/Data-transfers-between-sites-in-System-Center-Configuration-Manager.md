---
title: "System Center Configuration Manager 中的站点间数据传输"
ms.custom: na
ms.date: 09/02/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: 
  - configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
applies_to: 
  - System Center Configuration Manager (current branch)
ms.assetid: dc526e8d-fac3-4bb5-b206-03ad29b0ae11
caps.latest.revision: 12
caps.handback.revision: 12
---
# System Center Configuration Manager 中的站点间数据传输
[!INCLUDE[cm6long](../LocTest/includes/cm6long_md.md)] 使用 **基于文件的复制** 和 **数据库复制** 在站点之间传输不同类型的信息。  本主题中的以下内容可帮助你了解 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 如何在站点间移动数据，并了解如何管理你的网络上的数据传输：  
  
-   [基于文件的复制](#bkmk_fileroute)  
  
    -   [文件复制路由](#bkmk_routes)  
  
-   [数据库复制](#bkmk_dbrep)  
  
    -   [数据库复制链接](#bkmk_Dblinks)  
  
    -   [分布式视图](#bkmk_distviews)  
  
    -   [针对数据库复制链接上站点数据的计划传输](#BKMK_schedules)  
  
         [数据库复制流量汇总](#BKMK_SummarizeDBReplication)  
  
    -   [数据库复制阈值](#BKMK_DBRepThresholds)  
  
-   [站点数据库复制控件](#BKMK_DBRepControls)  
  
##  <a name="bkmk_fileroute"></a> 基于文件的复制  
 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 使用基于文件的复制在层次结构中的站点之间传输基于文件的数据。 此数据包括诸如以下内容：你要部署到子站点中的分发点的应用程序和包，以及传输到父站点（在其中处理记录）的未处理发现数据记录。  
  
 站点之间基于文件的通信通过 **TCP/IP 端口 445** 使用 **服务器消息块**(SMB) 协议。 你可以指定包括带宽限制和脉冲模式的配置来控制在网络上传输的数据量，并指定计划来控制何时在网络上发送数据。  
  
###  <a name="bkmk_routes"></a> 文件复制路由  
 下列信息可帮助你配置和使用文件复制路由：  
  
 **文件复制路由** - 每个文件复制路由都确定了可将基于文件的数据传输到其中的目标站点。 每个站点都支持到特定目标站点的单一文件复制路由。  
  
 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 支持以下文件复制路由配置：  
  
-   **文件复制帐户**：此帐户用于连接到目标站点并将数据写入该站点的 **SMS_SITE** 共享。 写入到此共享的数据由接收站点处理。 默认情况下，将站点添加到层次结构后， [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 将新站点的站点服务器计算机帐户指定为该站点的“文件复制帐户” 。 此帐户随后将被添加到目标站点的 **SMS_SiteToSiteConnection_<Sitecode\>** 组，该组是对 **SMS_SITE** 共享授予访问权限的计算机上的一个本地组。 你可以将此帐户更改为 Windows 用户帐户。 如果更改帐户，请确保将新帐户添加到目标站点的 **SMS_SiteToSiteConnection_<Sitecode\>** 组。  
  
    > [!NOTE]  
    >  辅助站点始终使用辅助站点服务器的计算机帐户作为“文件复制帐户” 。  
  
-   **计划**：你可以为每个文件复制路由配置计划，以限制可将数据传输到目标站点时的日期和时间的类型。  
  
-   **速率限制**：你可以为每个文件复制路由配置速率限制，以控制站点在将数据传输到目标站点时使用的网络带宽。  
  
    -   使用“脉冲模式”  来指定发送到目标站点的数据块的大小。 你也可以指定在两次发送各个数据块之间的时间延迟。 如果必须在连接到目标站点的极低带宽网络上发送数据，请使用此选项。 例如，你可能有每五秒发送 1 KB 数据（而不是每三秒发送 1 KB）的约束，而不管某个给定时间的链接速度或其使用率如何。  
  
    -   使用“限制为按小时指定的最大传输速率”  ，让站点仅使用你指定的时间百分比将数据发送到目标站点。 如果使用此选项， [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 将不会确定网络的可用带宽，而是将它可发送数据的时间划分为时间片段。 然后在一个短时间段内发送数据，之后的几个时间段则不发送数据。 例如，如果最大速率设置为 **50%**， [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 传输数据一段时间后将在相同的一段时间内不发送任何数据。 不会管理实际数据量大小或数据块大小， 而只会管理发送数据期间的时间量。  
  
        > [!CAUTION]  
        >  默认情况下，站点可使用最多三个“并发发送”  来将数据传输到目标站点。 如果为文件复制路由启用速率限制，则用于将数据发送到该站点的“并发发送”  数限制为 1。 即使“限制可用带宽(%)”  设置为“100%” ，这一点也适用。 例如，你为发送程序使用默认设置，则此设置会将传输到目标站点时的速率减少到默认能力的三分之一。  
  
-   你可以在两个辅助站点之间配置文件复制路由，以在这些站点之间传输基于文件的内容。  
  
 要管理文件复制路由，请在“管理”  工作区中展开“层次结构配置”  节点，并选择“文件复制” 。  
  
 **发送程序** - 每个站点均具有一个发送程序。 发送程序管理从一个站点到一个目标站点的网络连接，并且还可以同时与多个站点建立连接。 为连接到站点，发送程序使用指向站点的文件复制路由来标识要用于建立网络连接的帐户。 发送程序还使用此帐户将数据写到目标站点的 **SMS_SITE** 共享。  
  
 默认情况下，发送程序通过使用多个“并发发送” （通常指线程）将数据写到目标站点。 每个并发发送或线程可以将基于文件的不同对象传输到目标站点。 默认情况下，如果发送程序开始发送对象，则发送程序会持续写入该对象的数据块直到整个对象发送完毕。 在该对象的所有数据均已发送完毕后，即可在该线程上开始发送新的对象。  
  
 你可以为发送程序配置下列设置：  
  
-   **最大并发发送数**：默认情况下，每个站点已配置为使用五个“并发发送” ，并当其将数据发送至任何一个目标站点时均有三个可用。 当你提高此数字时，你可以通过启用 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 来提高站点之间的数据吞吐量，以同时传输更多文件。 提高此数字还会提高对站点之间的网络带宽的要求。  
  
-   **重试设置**：默认情况下，每个站点均已配置为对问题连接重试两次，并在连接尝试之间延迟一分钟。 你可以修改站点所做的连接尝试数以及这些尝试之间的等待时长。  
  
 若要管理站点的发送程序，请在“管理”  工作区中展开“站点配置”  节点，选择“站点”  节点，然后针对要管理的站点单击“属性”  。 单击“发送程序”  选项卡以更改发送程序配置。  
  
##  <a name="bkmk_dbrep"></a> 数据库复制  
 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 数据库复制使用 SQL Server 传输数据，并将站点数据库中所做的更改与存储在层次结构中其他站点上的数据库中的信息合并在一起。  
  
-   这能让所有站点共享相同的信息  
  
-   当你在层次结构中安装站点时，在新站点及其指定的父站点之间将自动配置数据库复制  
  
-   当站点安装完成后，数据库复制将自动开始  
  
 当向层次结构添加新站点时， [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 会在该新站点创建通用数据库。 接下来，父站点将在其数据库中创建相关数据的快照，然后通过基于文件的复制将该快照传输到新站点。 然后，新站点使用 SQL Server 成批复制程序 (BCP) 将信息加载到其 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 数据库的本地副本。 在快照加载后，每个站点均会与其他站点执行数据库复制。  
  
 为在站点之间复制数据， [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 会使用其自己的数据库复制服务。 数据库复制服务使用 SQL Server 更改跟踪来监视本地站点数据库的更改，然后使用 **SQL Server Service Broker**将那些更改复制到其他站点。 默认情况下，此过程使用 **TCP/IP 端口 4022**。  
  
 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 将由数据库复制来复制到不同复制组的数据分组。  
  
-   每个复制组具有单独而固定的复制计划，该计划将确定将组中的数据更改复制到其他站点的频率。  
  
     例如，对基于角色的管理配置的配置更改会快速复制到其他站点，以确保这些更改会尽快实施。 同时，在诸如请求安装新辅助站点之类更低优先级的配置发生更改时，将以较低的紧急程度进行复制，并且新建站点的请求需要经过数分钟才会传达到目标主站点  
  
-   对于数据库复制，可以修改以下方面：  
  
    -   **数据库复制链接** 能够让你控制特定流量遍历网络的时间。  
  
    -   **分布式视图** 是复制链接的一个配置，能够实现在管理中心站点针对选定站点数据发出请求，以从子主站点的数据库中直接访问该站点数据。  
  
    -   **计划** 允许你配置使用复制链接的情形并指定复制不同类型的站点数据的情形。  
  
    -   默认情况下，关于遍历复制链接的网络流量的数据**摘要** 每 15 分钟形成一次，并将在报表中用于数据复制。  
  
    -   **数据库复制阈值** 定义将链接报告为降级或失败的情形。 你还可以配置 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 在何时发出有关复制链接处于降级或失败状态的警报。  
  
 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 将数据库复制所复制的数据分为全局数据或站点数据两类。 当发生数据库复制时，将跨数据库复制链接来传输全局数据和站点数据的更改。 可将全局数据复制到父站点或子站点，而仅可将站点复制到父站点。 称为本地数据的第三类数据类型则不会复制到其他任何站点。 本地数据包括其他站点不要求的信息：  
  
-   **全局数据**：全局数据指将复制到整个层次结构中所有站点的由管理员创建的对象（虽然辅助站点仅接收作为全局代理数据的全局数据子集）。 全局数据的示例包括：软件部署、软件更新、集合定义和基于角色的管理安全作用域。 管理员在管理中心站点和主站点创建全局数据。  
  
-   **站点数据**：站点数据是指 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 主站点和向主站点报告的客户端创建的操作信息。 站点数据复制到管理中心站点，但不复制到其他主站点。 站点数据的例子包括：硬件清单数据、状态消息、警报和基于查询的集合的结果。 站点数据仅在管理中心站点和它源自的主站点中可供查看。 站点数据仅可在创建它们的主站上修改。  
  
     所有站点数据均会复制到管理中心站点；因此，管理中心站点可以对整个层次结构执行管理和报告。  
  
 以下部分详细介绍在管理数据库复制方面可以采用的配置  
  
###  <a name="bkmk_Dblinks"></a> 数据库复制链接  
 当你在层次结构中安装新站点时， [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 将自动在两个站点之间创建数据库复制链接。 将创建将新站点连接到父站点的单个链接。  
  
 每个数据库复制链接均可支持有助于控制跨复制链接传输数据的配置。 每个复制链接均支持单独的配置。 对数据库复制链接的控制包括以下各项：  
  
-   使用分布式视图来阻止将选定站点数据从主站点复制到管理中心站点，并使管理中心站点能够从主站点数据库中直接访问此数据。  
  
-   计划在何时将选定站点数据从子主站点传输到管理中心站点。  
  
-   定义用于确定数据库复制链接何时处于降级状态或已失败的设置。  
  
-   配置何时针对失败的复制链接发出警报。  
  
-   指定 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 对使用复制链接的复制流量的相关数据进行汇总的频率。 此数据在报表中使用。  
  
 若要配置数据库复制链接，可在 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 控制台中从“数据库复制”  节点编辑该链接的属性。 此节点同时出现在“监视”  工作区中和“管理”  工作区中的“层次结构配置”  节点下。 你可以从复制链接的父站点或子站点中编辑复制链接。  
  
> [!TIP]  
>  你可以编辑任一工作区内“数据库复制”  节点中的数据库复制链接。 但是，如果使用“监视”  工作区内的“数据库复制”  节点，则也可以查看复制链接的数据库复制状态，并且可以访问复制链接分析器工具以帮助你调查数据库复制的问题。  
  
 有关如何配置复制链接的信息，请参阅 [站点数据库复制控件](#BKMK_DBRepControls)。 有关如何监视复制的详细信息，请参阅 [How to monitor database replication links and replication status](../LocTest/Monitor-hierarchy-and-replication-infrastructure-in-System-Center-Configuration-Manager.md#BKMK_MonitorRepLinksAndStatuss) 主题中的 [Monitor hierarchy and replication infrastructure in System Center Configuration Manager](../LocTest/Monitor-hierarchy-and-replication-infrastructure-in-System-Center-Configuration-Manager.md) 部分。  
  
 使用下列部分中的信息来为数据库复制链接进行计划。  
  
###  <a name="bkmk_distviews"></a> 分布式视图  
 分布式视图能够实现在管理中心站点针对选定站点数据发出请求，以从子主站点的数据库中直接访问该站点数据。 该直接访问使得不再需要从主站点将该站点数据复制到管理中心站点。 由于每个复制链接均与其他复制链接无关，因此你可以仅在你选择的复制链接上启用分布式视图。 在主站点和辅助站点之间不支持分布式视图。  
  
 分布式视图可以提供以下好处：  
  
-   降低 CPU 负载以在管理中心站点和主站点上处理数据库更改。  
  
-   降低跨网络传输到管理中心站点的数据量。  
  
-   改善承载管理中心站点数据库的 SQL Server 性能。  
  
-   减少管理中心站点上数据库所用的磁盘空间。  
  
 当主站点在网络上临近管理中心站点，并且两个站点始终启动并始终相连时，考虑使用分布式视图。 这是因为分布式视图会将站点间选定数据的复制替换为每个站点上 SQL Server 之间的直接连接。 每次在管理中心站点上请求此数据时，均会建立该直接连接。 通常，在你运行报表或查询，在资源浏览器中查看信息时，你可能会通过对集合（其中含有基于站点数据的规则）进行集合评估，针对分布式视图启用数据请求。  
  
 默认情况下，将对每个复制链接禁用分布式视图。 当你针对复制链接启用分布式视图时，选择不会跨该链接复制到管理中心站点的站点数据，并使管理中心站点能够从共享该链接的子主站点的数据库中直接访问此数据。 你可以为分布式视图配置以下类型的站点数据：  
  
-   来自客户端的硬件清单数据  
  
-   来自客户端的软件清单和计数数据  
  
-   来自客户端、主站点和所有辅助站点的状态消息  
  
 在操作上，分布式视图对于在 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 控制台或报表中查看数据的管理用户不可见。 当对分布式视图的已启用数据发出请求时，承载管理中心站点数据库的 SQL Server 会直接访问子主站点的 SQL Server 以检索信息。 例如，你在管理中心站点上使用 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 控制台来请求关于两个站点的硬件清单的信息，并且仅有一个站点已对分布式视图启用硬件清单。 从管理中心站点的数据库中会检索未为分布式视图配置的站点的客户端清单信息。 从子主站点的数据库中会访问已为分布式视图配置的站点的客户端清单信息。 此信息将出现在 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 控制台或报表中，并与来源数据没有任何差别。  
  
 只要复制链接具有一类已对分布式视图启用的数据，子主站点就不会将该数据复制到管理中心站点。 在你关闭某类数据的分布式视图后，子主站点就会立即恢复将该数据复制到管理中心站点，并将其作为普通数据复制的一部分。 但是，必须先在主站点和管理中心站点之间将包含此数据的复制组重新初始化，管理中心站点上才会提供此数据。 与此类似，在你卸载已启用分布式视图的主站点后，管理中心站点必须先完成其数据的重新初始化，然后你才能在管理中心站点上访问已对分布式视图启用的数据。  
  
> [!IMPORTANT]  
>  当你在层次结构中的任何复制链接上使用分布式视图时，你必须先禁用所有复制链接的分布式视图，才能卸载任何主站点。 有关详细信息，请参阅 [Uninstall a primary site that is configured with distributed views](../LocTest/Uninstall-sites-and-hierarchies-in-System-Center-Configuration-Manager.md#BKMK_UninstallPrimaryDistViews)。  
  
 **分布式视图的先决条件和限制：**  
  
-   仅在管理中心站点和主站点之间的复制链接上才支持分布式视图。  
  
-   管理中心站点仅可以安装一个 SMS 提供程序实例，并且该实例必须安装在站点数据库服务器上。 这是支持 Kerberos 身份验证所必需的，要在管理中心站点上启用 SQL Server 来访问子主站点上的 SQL Server 就必须具有 Kerberos 身份验证。 对于子主站点上的 SMS 提供程序没有任何限制。  
  
-   管理中心站点仅可以安装一个 SQL Server Reporting Services 点，并且它必须位于站点数据库服务器上。 这是支持 Kerberos 身份验证所必需的，要在管理中心站点上启用 SQL Server 来访问子主站点上的 SQL Server 就必须具有 Kerberos 身份验证。  
  
-   SQL Server 群集上无法承载站点数据库。  
  
-   站点数据库无法承载在 SQL Server AlwaysOn 可用性组上。  
  
-   管理中心站点中数据库服务器的计算机帐户需要对主站点的站点数据库的 **Read** 权限。  
  
> [!IMPORTANT]  
>  对于数据库复制链接而言，分布式视图和数据复制时间计划是相互排斥的配置。  
  
###  <a name="BKMK_schedules"></a> 针对数据库复制链接上站点数据的计划传输  
 为了帮助你控制用于从子主站点将站点数据复制到其管理中心站点的网络带宽，你可以计划复制链接的使用时间，指定复制不同类型站点数据的时间。 你可以控制主站点复制状态消息、清单和计数数据的时间。 辅助站点中的数据库复制链接不支持站点数据计划。 无法计划全局数据传输。  
  
 配置数据库复制链接计划时，你可以限制从主站点至管理中心站点的所选站点数据的传输，并且可以配置复制不同类型站点数据的不同时间。  
  
> [!IMPORTANT]  
>  对于数据库复制链接而言，分布式视图和数据复制时间计划是相互排斥的配置。  
  
###  <a name="BKMK_SummarizeDBReplication"></a> 数据库复制流量汇总  
 每个站点会定期汇总关于遍历数据库复制链接（包括站点）的网络流量的数据。 此汇总数据用于数据库复制报表。 复制链接上的两个站点都汇总遍历复制链接的网络流量 数据汇总由承载站点数据库的 SQL Server 来执行。 进行数据汇总后，此信息会作为全局数据复制到其他站点。  
  
 默认情况下，汇总每 15 分钟发生一次。 通过在数据库复制链接属性中编辑“摘要间隔”  ，你可以修改网络流量汇总的频率。 汇总频率会影响你在报表中查看的关于数据库复制的信息。 你可以将此间隔从 5 分钟修改为 60 分钟。 如果增加汇总频率，则会增加复制链接上每个站点中 SQL Server 的处理负荷。  
  
###  <a name="BKMK_DBRepThresholds"></a> 数据库复制阈值  
 数据库复制阈值定义将数据库复制链接状态报告为降级或失败的时间。 默认情况下，当任何一个复制组无法在 12 次连续尝试期间完成复制时，会将链接设置为降级，当任何复制组无法在 24 次连续尝试中完成复制时，会将链接设置为失败。  
  
 可以指定自定义值，以微调 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 将复制链接报告为降级或失败的时间。 通过调整 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 报告数据库复制链接的每个状态的时间，可以帮助你准确地监视所有数据库复制链接的数据库复制健康状况。  
  
 因为一个或少数复制组可能无法复制，而其他复制组可以继续成功复制，因此在首次报告降级状态时，请计划查看复制链接的复制状态。 如果特定复制组定期出现延迟，并且其延迟未显示问题，或者如果站点之间的网络链接具有低可用带宽，请考虑修改链接的降级或失败状态的值并重试这些值。 如果在将链接设置为降级或失败之前增加重试次数，则可以消除已知问题的假警告，这样，你就可以更加准确地跟踪链接的状态。  
  
 你还应该考虑每个复制组的复制同步间隔，以了解该组的复制发生的频率。 在“监视”  工作区内“数据库复制”  节点中复制链接的“复制详细信息”  选项卡上，你可以查看复制组的“同步间隔”  。  
  
 有关如何监视数据库复制（包括如何查看复制状态）的详细信息，请参阅 [How to monitor database replication links and replication status](../LocTest/Monitor-hierarchy-and-replication-infrastructure-in-System-Center-Configuration-Manager.md#BKMK_MonitorRepLinksAndStatuss) 主题中的 [How to monitor database replication links and replication status](../LocTest/Monitor-hierarchy-and-replication-infrastructure-in-System-Center-Configuration-Manager.md#BKMK_MonitorRepLinksAndStatuss) 部分。  
  
 有关配置数据库复制阈值的信息，请参阅 [站点数据库复制控件](#BKMK_DBRepControls)。  
  
##  <a name="BKMK_DBRepControls"></a> 站点数据库复制控件  
 每个站点数据库都支持可以帮助你控制用于数据库复制的网络带宽的配置。 这些配置仅适用于在其中配置设置的站点数据库，当站点通过数据库复制将任何数据复制到任何其他站点时会始终使用这些配置。  
  
 每个站点数据库的复制控件包括以下各项：  
  
-   更改 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 用于 SQL Server Service Broker 的端口。  
  
-   配置在复制失败触发站点重新初始化其站点数据库副本之前等待的时间段。  
  
-   配置站点数据库以对其通过数据库复制所复制的数据进行压缩。 只会为站点之间的传输压缩数据，而不会为任一站点上站点数据库中的存储压缩数据。  
  
 若要为站点数据库配置复制控件，可以在 [!INCLUDE[cmshort](../LocTest/includes/cmshort_md.md)] 控制台中从“数据库复制”  节点编辑该站点数据库的属性。 此节点出现在“管理”  工作区中的“层次结构配置”  节点下面，也出现在“监视工作区” 中。 要编辑站点数据库的属性，请选择站点之间的复制链接，然后打开“父数据库属性”  或“子数据库属性” 。  
  
> [!TIP]  
>  你可以配置任一工作区内“数据库复制”  节点中的数据库复制控件。 但是，如果使用“监视”  工作区内的“数据库复制”  节点，则也可以查看复制链接的数据库复制状态，并且可以访问复制链接分析器工具以帮助你调查复制问题。  
  
## 另请参阅  
 [监视和维护 System Center Configuration Manager](../LocTest/Monitor-and-maintain-System-Center-Configuration-Manager.md)